# Task 3.2: gRPCサーバー設定とエラーハンドリング

## 説明

TonicベースのgRPCサーバー設定とエラーハンドリング基盤を構築します。McpErrorとtonic::Statusのマッピング機能を実装し、後続のサービス実装で使用する共通基盤を提供します。

## 受け入れ基準

- [ ] `server/src/grpc/server.rs`を作成し、gRPCサーバー設定を実装
- [ ] `McpError`と`tonic::Status`の相互変換機能を実装
- [ ] gRPCサーバーの基本的な起動設定を定義
- [ ] エラーハンドリングユーティリティ関数を作成
- [ ] 既存のtracing/loggingインフラストラクチャと統合
- [ ] 基本的な設定（ポート、アドレス等）の管理

## 実装内容

**ファイル作成:**
- `server/src/grpc/server.rs` - gRPCサーバー設定とセットアップ

**実装詳細:**
1. **エラー変換機能:**
   - `McpError` → `tonic::Status`の変換
   - 適切なgRPCステータスコードマッピング
   - エラーメッセージの構造化

2. **サーバー設定:**
   - Tonicサーバーの基本設定
   - ポート設定（デフォルト: 50051）
   - バインドアドレス設定
   - リフレクション機能の有効化（テスト用）

3. **ログ統合:**
   - gRPC操作での構造化ログ出力
   - 既存のtracingインフラストラクチャとの連携

## 技術的考慮事項

- anyhowとtonicエラーの適切なマッピング
- プロダクション環境での設定管理準備
- パフォーマンスを考慮した設定値
- セキュリティ考慮（後の設定で拡張可能）

## 依存関係

- **前提条件:** Task 3.1完了（gRPCモジュール基盤）

## ブロック対象

- Task 3.3: MCPコアサービススタブ実装（前半）
- 以降のすべてのサービス実装タスク

## 検証方法

- エラー変換機能のユニットテスト
- gRPCサーバーが起動可能（サービス未登録状態）
- ログ出力の確認
- 設定値の動作確認

## 実装優先度

**高優先度** - 全サービス実装で使用される共通基盤