# Rust コーディング規約（最小）

本プロジェクトのRustコードは、できるだけ標準の規約・慣習に従います。ここでは最小限の追加ルールのみを定めます。

## 方針と対象
- 対象: `server/`（Rustクレート）を含む本リポジトリのRustコード。
- 目的: 可読性・安全性・一貫性の維持。標準（言語・ツール）のデフォルトに従う。

## Rust バージョン/Edition
- Edition: 2021（`Cargo.toml` 準拠）。
- ツールチェーン: Rust 安定版（stable）を原則とする。

## フォーマット（rustfmt）
- `rustfmt` による整形を必須とする（基本はデフォルト設定）。
- 提出前に整形すること。

## Lint（Clippy）
- `clippy` を実行し、警告は原則解消する。
- 例外が必要な場合は、局所に `#[allow(...)]` を付け、理由をコメントで残す。グローバル抑制は避ける。

## 命名・可視性
- 命名は標準に従う:
  - 関数/変数/モジュール: `snake_case`
  - 型/トレイト/列挙体: `UpperCamelCase`
  - 定数/静的: `SCREAMING_SNAKE_CASE`
- 可視性は最小限（`pub` は必要な範囲に限定、`pub(crate)` を優先）。

## モジュール構成（Rust 2018+ 推奨スタイル）
- `mod.rs` は使用しない。常にファイルは「module_name.rs」を用いる。
- サブモジュールも同様。親の `module_name.rs` に `pub mod child;` を宣言し、`module_name/child.rs` を配置する。

## エラー処理
- 例外的状況は `Result` で表現し、`?` で伝播する。
- 実行バイナリ（アプリ）側では `anyhow::Result` を用いて文脈情報（`anyhow::Context`）を付与する。
- テスト以外での `unwrap`/`expect` は避ける。`panic!` は初期化失敗などの非回復エラーに限定。

## 非同期（async）
- ランタイムは `tokio` を使用する。
- 非同期関数内でのブロッキング処理は禁止。必要時は `tokio::task::spawn_blocking` を使う。

## ロギング/トレーシング
- `tracing` を使用する。処理境界やI/Oには適切にスパン/イベントを記録する。

## テスト
- 単体テスト: 同一ファイル内に `#[cfg(test)] mod tests { ... }`。
- 統合テスト: `tests/` ディレクトリに配置。
- 非同期テストは `#[tokio::test]` を用いる。

## ドキュメンテーション
- 公開APIには `///` の rustdoc コメントを付ける。例があると望ましい。

## unsafe の扱い
- `unsafe` は原則禁止。やむを得ず使用する場合は、最小化し詳細な安全性の根拠と不変条件をコメントで明記する。
